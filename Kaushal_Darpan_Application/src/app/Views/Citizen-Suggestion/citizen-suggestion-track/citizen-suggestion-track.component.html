<div class="container-fluid p-3 py-5 bg-primary text-white text-center">
  <h3 class="mt-0 text-white">Citizen Suggestions Track</h3>
  <p class="mb-0">If you have applied any Suggestions/Query to any department or college please fill the SR. No. to track your application</p>
  <a routerLink="/citizensuggestion" class="btn bg-info text-white mt-3">New Suggestion/Query</a>
</div>

<div class="container-fluid AboutSection position-relative" style="background: #deebff !important;">
  <img src="/assets/home/img/shape1.png" class="position-absolute shape2 left_image_bounce" />
  <div class="container-xl position-relative" >
    <div class="row">
      <div class="col-lg-12 col-md-12 col-sm-12 col-12">
        <div class="card">
          <div class="card-body">
            <div class="row">
              <div class="col-lg-4 col-md-4 col-sm-12  col-12">
                <label class="text-gray-800 text-sm font-medium inline-block mb-1">Search Your Request By SR Number</label>
                <input type="text" class="form-input form-control" placeholder="Search Your Request By SR Number" [(ngModel)]="searchRequest.SRNumber">
              </div>
              <div class="col-lg-3 col-md-4 col-sm-12  col-12 pt-4">
                <button class="btn btn-info text-white me-1" type="button" (click)="openModalSRNData(modal_SRNData)"><i class="fa fa-search"></i> Search</button>
                <a class="btn btn-primary text-white" (click)="ForgotSRN()"> Forgot SR No</a>
              </div>
              <div class="col-lg-4 col-md-4 col-sm-12 col-12" *ngIf="showMobileInput">
                <label class="text-gray-800 text-sm font-medium inline-block mb-1">Mobile number</label>
                <div class="d-flex justify-content-between align-items-center">
                  <input type="text" maxlength="10" class="form-input form-control" placeholder="Enter Mobile Number" [(ngModel)]="MobileNo"
                         (change)="MobileNo = filterNumber(MobileNo)">

                  <button class="btn btn-info text-white text-nowrap" type="button" (click)="openModalGenerateOTP(modal_GenrateOTP, MobileNo)">Send OTP</button>
                </div>
              </div>
            </div>
            
            <div class="row mt-4" *ngIf="OtpVerified">
              <div class="col-lg-12 col-md-12 col-sm-12 col-12">
                <div class="table-responsive">
                  <div class="overflow-x-auto mt-3">
                    <table class="table table-border w-full table-auto" cellpadding="5">
                      <thead class="bg-light/40 border-b border-gray-100 dark:bg-light/5 dark:border-b-gray-700 h-10">
                        <tr>
                          <th class="text-left">S.No</th>
                          <th class="text-left">Apply For</th>
                          <th class="text-left">Subject Name</th>
                          <th class="text-left">SR Number</th>
                          <th class="text-left">Email</th>
                          <th class="text-left">Mobile No</th>
                          <th class="text-left">Created Date</th>
                          <th class="text-left">Aging Days</th>
                          <th class="text-left"> Status</th>
                          <th class="text-left"> User Rating</th>
                          <th class="text-left"> Rating Remarks</th>
                          <th class="text-left"> Action</th>
                        </tr>
                      </thead>
                      <tbody>
                        @for (item of SRNDataList; track item; let idx = $index) {
                        <tr>
                          <td align="left">{{idx+1}}</td>
                          <td align="left">{{item.ApplyFor}}</td>
                          <td align="left">{{item.SubjectName}}</td>
                          <td align="left">{{item.SRNo}}</td>
                          <td align="left">{{item.Email}}</td>
                          <td align="left">{{item.MobileNo}}</td>
                          <td align="left">{{item.RTS | date: 'yyyy-MM-dd'}}</td>
                          <td align="left">{{item.AgingDays}}</td>
                          <td align="left">{{item.IsResolved ? 'Resolved' : 'Pending'}}</td>
                          <td>
                            <div class="col-lg-12 col-md-12 col-sm-12 col-12 mb-3 starFlexBox d-flex mt-3" fxLayout="row" fxLayoutAlign="start center">
                              <div *ngFor="let star of stars; let i = index">
                                <mat-icon [ngClass]="[star.class]">
                                  {{ getStarIcon(i + 1, item.UserRating) }}
                                </mat-icon>
                              </div>
                            </div>
                          </td>
                          <td align="left">{{item.RatingRemark}}</td>
                          <td align="left">
                            <button class="btn btn-info text-white" type="button" (click)="openModalSRNData(modal_SRNData, item.SRNo)"> <i class="fa fa-eye"></i></button>
                          </td>
                        </tr>
                        }
                      </tbody>
                      
                    </table>
                  </div>
                </div>
              </div>
            </div>

          </div>
        </div>
      </div>
    </div>
    <!--Start Model Popup-->
    <ng-template #modal_GenrateOTP let-modal class=" h-full fixed top-0 left-0 z-[80] transition-all duration-500 overflow-y-auto [--overlay-backdrop:static] hidden">
      <div class="modal-content">
        <div class="card">
          <div class="card-header d-flex justify-content-between  align-items-center">
            <b>
              <i class="fa fa-comment"></i>&nbsp; OTP verification for SR Data
            </b>
            <button class="btn bg-info text-white" (click)="CloseModal()"><i class="ti ti-x"></i></button>
          </div>
          <div class="card-body">
            <p class="text-center">
              <span class="mobile-text">Enter the OTP you recevied at  <b class="text-success">+91 {{MobileNo}}</b></span>
            </p>
            <div class="mt-4">
              <label class="text-gray-800 text-sm font-medium inline-block mb-1">Enter OTP</label>
              <input type="text" (keypress)="numberOnly($event)" maxlength="6" class="form-control" [(ngModel)]="OTP" placeholder="Enter OTP">
            </div>
          </div>
          <div class="text-center flex items-center justify-center mt-3">
            <button (click)="VerifyOTP()" type="button" id="btnSave" class="btn bg-info text-white"><i class="ti ti-device-floppy"></i> Verify OTP</button>
            <p class="text-danger" *ngIf="!showResendButton">Resend OTP available in: {{ formatTime(timeLeft) }}</p>
            <button *ngIf="showResendButton" (click)="SendOTP(true)" type="button" class="btn bg-danger text-white"><i class="ti ti-refresh"></i> Resend OTP</button>
          </div>
          <br />
        </div>
      </div>
    </ng-template>
    <!--END Model Popup-->

    
  </div>
</div> 

<ng-template #modal_SRNData let-modal class=" h-full fixed top-0 left-0 z-[80] transition-all duration-500 overflow-y-auto [--overlay-backdrop:static] hidden">
  <div class="modal-content">
    <div class="card">
      <div class="card-header d-flex justify-content-between items-center">
        <b><i class="fa fa-comment"></i>&nbsp; SR Number Data  </b>
        <button class="btn bg-info text-white" (click)="CloseModal()"><i class="ti ti-x"></i></button>
      </div>
      <div class="card-body">
        <div class="row mt-4" *ngIf="SreachResponse==true">
          <div class="col-lg-12 col-md-12 col-sm-12 col-12">
            <div class="table-responsive" >
              <table class="table table-striped table-hover">
                <thead>
                  <tr>
                    <th width="200">Title</th>
                    <th>Details</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td><b>Query Status</b></td>
                    <td>{{CitizenSuggestionList.IsResolved ? 'Resolved' : 'Pending'}}</td>
                  </tr>
                  <tr>
                    <td><b>Name</b></td>
                    <td>{{CitizenSuggestionList.Name}}</td>
                  </tr>
                  <tr>
                    <td><b>Email</b></td>
                    <td>{{CitizenSuggestionList.Email}}</td>
                  </tr>

                  <tr>
                    <td><b>Mobile No</b></td>
                    <td>{{CitizenSuggestionList.MobileNo}}</td>
                  </tr>

                  <tr>
                    <td><b>Apply For</b></td>
                    <td>{{CitizenSuggestionList.ApplyFor}}</td>
                  </tr>
                  <tr>
                    <td><b>Subject</b></td>
                    <td>{{CitizenSuggestionList.SubjectName}}</td>
                  </tr>

                  <tr *ngIf="ResponseForCollege==true">
                    <td><b>College</b></td>
                    <td>{{CitizenSuggestionList.PolytechnicName}}</td>
                  </tr>
                  <tr>
                    <td><b>Comment/Messege</b></td>
                    <td>{{CitizenSuggestionList.Comment}}</td>
                  </tr>

                  <tr>
                    <td><b>Attached File By you</b></td>
                    <td *ngIf="CitizenSuggestionList.AttchFilePath !== ''"><a href="{{appsettingConfig.StaticFileRootPathURL}}{{ProfileLists.FolderName}}{{CitizenSuggestionList.AttchFilePath}}" target="_blank">View</a></td>
                    <td *ngIf="CitizenSuggestionList.AttchFilePath === ''">No File</td>
                  </tr>
                  <tr>
                    <td><b>Response By Department/College</b></td>
                    <td>{{CitizenSuggestionList.Replay}}</td>
                  </tr>
                  <tr>
                    <td><b>Attached File By Department/College</b></td>

                    <td *ngIf="CitizenSuggestionList.ReplayAttachment !== 'Pending'"><a href="{{appsettingConfig.StaticFileRootPathURL}}{{ProfileLists.FolderName}}{{CitizenSuggestionList.ReplayAttachment}}" target="_blank">View</a></td>
                    <td *ngIf="CitizenSuggestionList.ReplayAttachment === 'Pending' || CitizenSuggestionList.ReplayAttachment === ''">No File</td>
                  </tr>
                  <tr>
                    <td><b>User Rating</b></td>
                    <!-- <td>{{CitizenSuggestionList.UserRating != 0 ? CitizenSuggestionList.UserRating : 'Not Rated'}}</td> -->
                    <td>
                      <div class="col-lg-12 col-md-12 col-sm-12 col-12 mb-3 d-flex mt-3" fxLayout="row" fxLayoutAlign="start center">
                        <div *ngFor="let star of stars" [ngClass]="[star.class]">
                          <mat-icon (click)="!isDisabled && selectedStar(star.id)"
                                    [class.disabled]="isDisabled">
                            {{ star.icon }}
                          </mat-icon>
                        </div>
                      </div>
                    </td>
                  </tr>
                  <tr>
                    <td><b>Rating Remarks</b></td>
                    <td>{{CitizenSuggestionList.RatingRemark}}</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div class="text-center flex items-center justify-center mt-3 gap-2">
        <button type="button" class="btn bg-info text-white mr-2" style="margin-right: 10px;" *ngIf="CitizenSuggestionList?.IsResolved===true && CitizenSuggestionList?.UserRating == 0"
          (click)="openModalFeedbackForm(modal_FeedbackForm, CitizenSuggestionList?.SRNo, CitizenSuggestionList?.Pk_ID)"> Feedback</button>
        <button (click)="CloseModal()" type="button" class="btn bg-danger text-white"> Close</button>
      </div>
      <br />
    </div>
  </div>
</ng-template>
<ng-template #modal_FeedbackForm let-modal class="h-full fixed top-0 left-0 z-[80] transition-all duration-500 overflow-y-auto [--overlay-backdrop:static] hidden">
  <div class="modal-content">
    <div class="card">
      <div class="card-header d-flex justify-content-between">
        <b><i class="fa fa-comment"></i>&nbsp; Feedback Form</b>
        <button class="btn bg-info text-white" (click)="CloseModalFeedbackForm()"><i class="ti ti-x"></i></button>
      </div>
      
      <div class="card-body">
        <div class="row">
          <div class="col-lg-12 col-md-12 col-sm-12 col-12 mb-3">
            <label class="text-gray-800 text-sm font-medium inline-block mb-1">Rating Remarks</label>
            <textarea type="text" class="form-control" placeholder="Enter Rating Remarks" [(ngModel)]="ratingRequest.RatingRemarks"></textarea>
          </div>

          <div class="col-lg-12 col-md-12 col-sm-12 col-12 mb-3 d-flex mt-3" fxLayout="row" fxLayoutAlign="start center" >

              <div *ngFor="let star of stars" [ngClass]="[star.class]" >
                  <mat-icon (click)="selectStar(star.id)">{{star.icon}}</mat-icon>
              </div>
          </div>
          <div style="width: 60%;"><span >Rating {{ratingRequest.UserRating}} / 5</span></div>
        </div>
        
        <div class="text-center flex items-center justify-center mt-3 gap-2">
          <button type="button" class="btn bg-info text-white"  style="margin-right: 10px;" (click)="SaveUserRating()">Feedback</button>
          <button (click)="CloseModalFeedbackForm()" type="button" class="btn bg-danger text-white">Close</button>
        </div>
      </div>
      <br />
    </div>
  </div>
</ng-template>
