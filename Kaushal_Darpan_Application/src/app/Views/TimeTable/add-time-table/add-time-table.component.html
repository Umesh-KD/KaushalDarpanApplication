<app-loader> </app-loader>
<!-- Page Title Start -->
<div class="flex items-center justify-between flex-wrap gap-2 mb-6">
  <div>
    <h4 class="text-slate-900 text-lg font-medium mb-2">Add/Edit Time Table</h4>

    <div class="md:flex hidden items-center gap-3 text-sm font-semibold">
      <a routerLink="/dashboard" class="text-sm font-medium text-slate-700">Dashboard</a>
      <i class="material-symbols-rounded text-xl flex-shrink-0 text-slate-500">chevron_right</i>
      <a routerLink="/timetable" class="text-sm font-medium text-slate-700" aria-current="page">Time Table</a>
      <i class="material-symbols-rounded text-xl flex-shrink-0 text-slate-500">chevron_right</i>
      <a routerLink="/addtimetable" class="text-sm font-medium text-slate-700" aria-current="page">Add/Edit Time Table</a>
    </div>
  </div>
  <a routerLink="/timetable" class="inline-flex items-center btn bg-dark text-white btn-sm">
    <i class="ti ti-chevron-left"></i>
    Back
  </a>
</div>
<!-- Page Title End -->
<!-- Form Start -->
<div class="card">
  <div class="card-body p-5">
    <div class="mb-8">
      <div class="flex justify-between flex-wrap items-center mb-3 p-3 py-2 bg-light">
        <b class="text-1xl-5"><i class="ti ti-plus"></i> Add/Edit Time Table</b>
      </div>
      <form [formGroup]="TimeTableForm">
        <div class="mb-3">
          <div class="grid xl:grid-cols-3 lg:grid-cols-3 md:grid-cols-2 gap-6">

            <div>
              <label class="text-gray-800 text-sm font-medium inline-block mb-1"> Examination Scheme:</label>
              <select class="form-select" id="StudentExamYear"
                      formControlName="IsYearly"
                      [(ngModel)]="request.IsYearly"
                      (change)="ExaminationSchemeChange()">
                <option value="-1">--Select All--</option>
                <option value=0>Semester</option>
                <option value=1>Yearly</option>
              </select>

            </div>

            <div>
              <label class="text-gray-800 text-sm font-medium inline-block mb-1">
                Year/Semester: <span class="StarMarking">*</span>
              </label>
              <select class="form-select" formControlName="SemesterID" [(ngModel)]="request.SemesterID" (change)="GetSubjectCodeMasterDDL()">
                <option value="0">Select Semester/Year</option>
                <option *ngFor="let row of filteredSemesterList" [value]="row.SemesterID">{{row.SemesterName}}</option>
              </select>
              <div *ngIf="isSubmitted&&_TimeTableForm.SemesterID.errors" class="text-danger">
                <p *ngIf="!_TimeTableForm.SemesterID.errors.DropdownValidators">
                  <i aria-hidden="true"></i>This field is required .!
                </p>
              </div>
            </div>

            <div>
              <label class="text-gray-800 text-sm font-medium inline-block mb-1">
                Exam Date: <span class="StarMarking">*</span>
              </label>
              <input type="date" class="form-input" formControlName="ExamDate" [(ngModel)]="request.ExamDate" [min]="minDate">
              <div *ngIf="isSubmitted&&_TimeTableForm.ExamDate.errors" class="text-danger">
                <p *ngIf="_TimeTableForm.ExamDate.errors.required"><i aria-hidden="true"></i> This field is required .!</p>
              </div>
            </div>
            <!-- <div>
    <label for="txtFields" class="text-gray-800 text-sm font-medium inline-block mb-2">Start Time<span class="StarMarking">*</span></label>
    <input type="time" class="form-input" name="txtSubjectName" formControlName="StartTime" [(ngModel)]="request.StartTime">
    <div *ngIf="isSubmitted&&_TimeTableForm.StartTime.errors" class="text-danger">
      <p *ngIf="_TimeTableForm.StartTime.errors.required"><i aria-hidden="true"></i> This field is required .!</p>
    </div>

  </div>
  <div>
    <label for="txtFields" class="text-gray-800 text-sm font-medium inline-block mb-2">End Time<span class="StarMarking">*</span></label>
    <input type="time" class="form-input" name="txtSubjectName" formControlName="EndTime" [(ngModel)]="request.EndTime">
    <div *ngIf="isSubmitted&&_TimeTableForm.EndTime.errors" class="text-danger">
      <p *ngIf="_TimeTableForm.EndTime.errors.required"><i aria-hidden="true"></i> This field is required .!</p>
    </div>

    <div *ngIf="_TimeTableForm.timeRangeInvalid">
      <small class="error">{{ timeForm.errors?.timeRangeInvalid }}</small>
    </div>
  </div> -->
            <div>
              <label class="text-gray-800 text-sm font-medium inline-block mb-1">
                Shift: <span class="StarMarking">*</span>
              </label>
              <select class="form-select" formControlName="ShiftID" [(ngModel)]="request.ShiftID">
                <option value="0">---Select Shift---
               </option>
              
                <option *ngFor="let row of ExamShiftList" [value]="row.ShiftID">{{row.ExamShift}}</option>
              </select>
              <div *ngIf="isSubmitted&&_TimeTableForm.ShiftID.errors" class="text-danger">
                <p *ngIf="!_TimeTableForm.ShiftID.errors.DropdownValidators">
                  <i aria-hidden="true"></i>This field is required .!
                </p>
              </div>
            </div>
          </div>
        </div>
      </form>

      <div class="flex justify-between flex-wrap items-center mb-3 p-3 py-2 bg-light">
        <b class="text-1xl-5">Add Subjects</b>
      </div>
      <form [formGroup]="BranchSubjectFormGroup">
        <div class="mb-3">
          <div class="grid xl:grid-cols-3 lg:grid-cols-3 md:grid-cols-2 gap-6 my-3">
            <!-- <div>
              <label class="text-gray-800 text-sm font-medium inline-block mb-1">
                Branch: <span class="StarMarking">*</span>
              </label>
              <ng-multiselect-dropdown formControlName="selectedItems" [placeholder]="'Choose Option'"
                                       [settings]="settingsMultiselect"
                                       [data]="BranchMasterList"
                                       [(ngModel)]="SelectedBranchMasterList"
                                       [disabled]="false">
              </ng-multiselect-dropdown>
              <div *ngIf="isBranchSubSubmitted&& _BranchSubjectFormGroup?.selectedItems?.invalid" class="text-danger">
                Please select at least one option.
              </div>
            </div> -->

            <div>
              <label class="text-gray-800 text-sm font-medium inline-block mb-1">Subject Code <span class="StarMarking">*</span></label>
              <select class="form-select" (change)="ddlSemester_Change()" formControlName="SubjectCode" id="SubjectCode" [(ngModel)]="request.SubjectCode">
                <option value="">--Select--</option>
                <option *ngFor="let item of SubjectCodeMasterDDLList" [value]="item.Code">{{item.Code}} {{item.Name}}</option>
              </select>
              <!-- <div *ngIf="isSubmitted && _TimeTableForm.SubjectCode.errors" class="text-danger">
                <p *ngIf="_TimeTableForm.SubjectCode.errors.required"><i aria-hidden="true"></i>This field is required.</p>
              </div> -->
            </div>

            <div>
              <label class="text-gray-800 text-sm font-medium inline-block mb-1">
                Subject <span class="StarMarking">*</span>
              </label>
              <ng-multiselect-dropdown #multiSelect [placeholder]="'--Select--'" [data]="SubjectMasterDDLList"
                                       [formControl]="_BranchSubjectFormGroup.selectedItems" [(ngModel)]="SelectedSubjectList" [settings]="settingsMultiselector"
                                       [disabled]="false" (onFilterChanges)="onFilterChanges($event)" (onDropDownCloses)="onDropDownCloses($event)"
                                       (onSelects)="onItemSelects($event)" (onDeSelects)="onDeSelects($event)" (onSelectAlls)="onSelectAlls($event)"
                                       (onDeSelectAlls)="onDeSelectAlls($event)">
              </ng-multiselect-dropdown>
              <div *ngIf="isBranchSubSubmitted&& _BranchSubjectFormGroup?.selectedItems?.invalid" class="text-danger">
                Please select at least one option.
              </div>
            </div>


            <div class="pt-30">
              <button type="button" class="btn bg-primary text-white" (click)="AddBranchSubject()"><i class="ti ti-plus"></i> Add More</button>
              <button type="button" class="btn bg-light text-dark" (click)="ResetRow()"><i class="ti ti-refresh"></i> Reset</button>
            </div>
          </div>
        </div>
      </form>

    </div>


    <div class="flex justify-between items-center mb-3 p-3 py-2 bg-light">
      <b class="text-1xl-5">Branch and Subject List </b>

      <div class="flex justify-between items-center">
        <div class="flex items-center me-3">
          <label class="block me-2 text-sm font-medium text-gray-900 dark:text-white items-center"
                 for="fileStudentPhoto">Import Excel</label>
          <div class="flex fileUploader bg-gray-100">
          
          <input class="bg-blue-500 text-white text-sm py-1 px-2 rounded-md focus:outline-none" [(ngModel)]="importFile"
           id="fileStudentPhoto" type="file" (change)="onFileChange($event)" accept=".xls,.xlsx">
            <label for="fileStudentPhoto">
              <span>Choose File</span>
              {{selectedFile ? selectedFile.name : 'No file chosen'}}
            </label>
          </div>

          
        </div>
        <a href="javascript:void(0);" class="btn bg-info btn-sm text-white" (click)="SampleexportExcelData()"><i class="ti ti-download"></i> Sample Format Semester</a>
        <a href="javascript:void(0);" class="btn bg-info btn-sm text-white" (click)="SampleexportExcelDataYearly()"><i class="ti ti-download"></i> Sample Format Yearly</a>
      </div>
    </div>

    <div class="overflow-auto max-height500">
      <table class="w-full table-border" cellpadding="5">
        <thead class="bg-light/40 border-b border-gray-100 dark:bg-light/5 dark:border-b-gray-700">

          <tr>
            <th>#</th>
            <th class="text-left">Branch Name</th>
            <th class="text-left">Subject Name</th>
            <th class="text-left">Paper Code</th>
            <th>Action</th>
          </tr>

        </thead>
        <tbody>
          <tr *ngFor="let row of request.BranchSubjectDataModel; let idx = index;">
            <td class="text-left">{{idx+1}}</td>
            <td class="text-left">{{row.BranchName}}</td>
            <td class="text-left">{{row.SubjectName}}</td>
            <td class="text-left">{{row.PaperCode}}</td>
            <td class="text-center">
              <button class="btn bg-danger text-white" type="button" title="Delete" (click)="DeleteRow(row)">
                <i class="ti ti-trash"></i>
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>



    <!--<table class="table-auto w-full mt-4" *ngIf="excelData.length > 0">
      <thead>
        <tr>
          <th class="border px-2 py-1">#</th>
          <th class="border px-2 py-1">Branch Name</th>
          <th class="border px-2 py-1">Subject Name</th>
          <th class="border px-2 py-1">Subject Code</th>
          <th class="border px-2 py-1">Action</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let row of excelData; let i = index">
          <td class="border px-2 py-1">{{ i + 1 }}</td>
          <td class="border px-2 py-1">{{ row.StreamName }}</td>
          <td class="border px-2 py-1">{{ row.SubjectName }}</td>
          <td class="border px-2 py-1">{{ row.SubjectCode }}</td>
          <td class="text-center">
            <button class="btn bg-danger text-white" type="button" title="Delete" (click)="DeleteRow(row)">
              <i class="ti ti-trash"></i>
            </button>
          </td>
        </tr>
      </tbody>
    </table>-->

    <div class="p-4">
      <button type="submit" class="btn bg-info text-white mt-6 me-1" (click)="saveData()">Submit</button>
      <button type="button" id="btnReset" (click)="ResetControl()" class="btn bg-danger text-white">
        <i class="ti ti-refresh"></i> Reset
      </button>
    </div>
  </div>
</div>
<!-- Form End -->


<ng-template #MyModel_ViewDetails let-modal
             class="w-full h-full fixed top-0 left-0 z-[80] transition-all duration-500 overflow-y-auto [--overlay-backdrop:static] hidden">
  <div class="modal-content">
    <div class="card">
      <div class="card-header flex justify-between  items-center">
        <div class="text-center">
          <b><i class="ti ti-plus"></i>Excel Data</b>
        </div>
        <a href="javascript:void(0);" style="display:none" class="btn bg-info text-white" (click)="exportToExcel()"><i class="ti ti-download"></i> Export To Excel</a>
        <button class="btn bg-info text-white" (click)="CloseModalPopup()"><i class="ti ti-x"></i></button>
      </div>
      <div class="card-body">
        <div class="mb-8">

          <div class="overflow-x-auto mt-3">

            <table class="table table-border w-full table-auto" cellpadding="5">
              <thead class="bg-light/40 border-b border-gray-100 dark:bg-light/5 dark:border-b-gray-700 h-10">
                <tr>
                  <th class="text-left">#</th>
                  <th class="text-left">Semester</th>
                  <th class="text-left">Semester Type</th>
                  <th class="text-left">Exam Date</th>
                  <th class="text-left">Shift</th>
                  <th class="text-left">Subject Code</th>
              
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let row of ImportExcelList; let idx = index;">
                  <td class="text-left">{{idx+1}}</td>
                  <td align="left">{{row.ShortCode}}</td>
                  <td align="left">{{row.ExamType}}</td>
                  <td align="left">{{row.ExamDate}}</td>
                  <td align="left">{{row.ShiftID}}</td>
                  <td align="left">{{row.SubjectCode}}</td>

                </tr>
              </tbody>


            </table>
          </div>
        </div>
        <div>
          <button type="submit"
                  id="btnSave"
                  class="btn bg-info text-white mt-6" (click)="SaveImportExcelData()">
            Submit
          </button>
        </div>
      </div>
      <div class="grid 2xl:grid-cols-1 xl:grid-cols-1 lg:grid-cols-1 md:grid-cols-1 grid-cols-1 gap-3">
      </div>
    </div>
  </div>
</ng-template>
