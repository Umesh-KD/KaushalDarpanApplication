<div class="card">
  <div class="card-body p-5">
    <div class="flex justify-between flex-wrap items-center mb-3 p-3 py-2 bg-light">
      <b class="text-1xl-5"><i class="ti ti-list"></i> Save Roster Display</b>
    </div>

    <div>
      <mat-form-field class="mt-3 mx-2" id="InstituteName" appearance="fill" *ngIf="sSOLoginDataModel.InstituteID !== 0"
                      style="width: 100%; max-width: 240px;">
        <mat-label>College Name</mat-label>
        <input disabled="disabled" style="font-weight: bold;" class="text-xs" matInput value="{{InstituteName}}" name="InstituteName">
      </mat-form-field>
    </div>

    <form [formGroup]="TableForm" (ngSubmit)="saveAttendance()">
      <div class="grid xl:grid-cols-4 lg:grid-cols-4 md:grid-cols-4 gap-6">
        <div>
          <label class="text-gray-800 text-sm font-medium inline-block mb-1"> Stream<span class="StarMarking">*</span></label>
          <ng-select formControlName="StreamID" [clearable]="false">
            <ng-option [value]="0">--Select--</ng-option>
            @for (item of StreamMasterDDL; track item.StreamID) {
            <ng-option [value]="item.StreamID">{{item.StreamName}}</ng-option>
            }
          </ng-select>
          <div *ngIf="isSubmitted && formTable.StreamID.errors" class="text-danger">
            <p *ngIf="formTable.StreamID.errors.required"><i aria-hidden="true"></i> This field is required .!</p>
            <p *ngIf="formTable.StreamID.errors.DropdownValidators"><i aria-hidden="true"></i> This field is required .!</p>
          </div>
        </div>

        <div>
          <label class="text-gray-800 text-sm font-medium inline-block mb-1"> Semester<span class="StarMarking">*</span></label>
          <ng-select formControlName="SemesterID" [clearable]="false" (change)="getSubjectMasterDDL(TableForm.value.StreamID, TableForm.value.SemesterID)">
            <ng-option [value]="0">--Select--</ng-option>
            @for (item of SemesterMasterDDL; track item.SemesterID) {
            <ng-option [value]="item.SemesterID">{{item.SemesterName}}</ng-option>
            }
          </ng-select>
          <div *ngIf="isSubmitted && formTable.SemesterID.errors" class="text-danger">
            <p *ngIf="formTable.SemesterID.errors.required"><i aria-hidden="true"></i> This field is required .!</p>
            <p *ngIf="formTable.SemesterID.errors.DropdownValidators"><i aria-hidden="true"></i> This field is required .!</p>
          </div>
        </div>

        <div>
          <label class="text-gray-800 text-sm font-medium inline-block mb-1"> Subject<span class="StarMarking">*</span></label>
          <ng-select formControlName="SubjectID" [clearable]="false">
            <ng-option [value]="0">--Select--</ng-option>
            @for (item of SubjectMasterDDL; track item.ID) {
            <ng-option [value]="item.ID">{{item.Name}}</ng-option>
            }
          </ng-select>
          <div *ngIf="isSubmitted && formTable.SubjectID.errors" class="text-danger">
            <p *ngIf="formTable.SubjectID.errors.required"><i aria-hidden="true"></i> This field is required .!</p>
            <p *ngIf="formTable.SubjectID.errors.DropdownValidators"><i aria-hidden="true"></i> This field is required .!</p>
          </div>
        </div>

        <div>
          <label class="text-gray-800 text-sm font-medium inline-block mb-1"> Teachers<span class="StarMarking">*</span></label>
          <ng-select formControlName="StaffID" [clearable]="false">
            <ng-option [value]="0">--Select--</ng-option>
            @for (item of ExaminerDDL; track item.StaffID) {
            <ng-option [value]="item.StaffID">{{item.Name}}</ng-option>
            }
          </ng-select>
          <div *ngIf="isSubmitted && formTable.StaffID.errors" class="text-danger">
            <p *ngIf="formTable.StaffID.errors.required"><i aria-hidden="true"></i> This field is required .!</p>
            <p *ngIf="formTable.StaffID.errors.DropdownValidators"><i aria-hidden="true"></i> This field is required .!</p>
          </div>
        </div>
        <div>
          <mat-form-field appearance="fill" class="w-full">
            <mat-label>Attendance Date</mat-label>
            <input matInput [matDatepicker]="startDatePicker" formControlName="AttendanceDate">
            <!--<mat-datepicker-toggle matSuffix [for]="startDatePicker"></mat-datepicker-toggle>-->
            <mat-datepicker #startDatePicker></mat-datepicker>
          </mat-form-field>
        </div>

        <!-- Start Time Picker -->
        <div>
          <mat-form-field appearance="fill" class="w-full">
            <mat-label>Start Time</mat-label>
            <input matInput [ngxTimepicker]="startTimePicker" formControlName="AttendanceStartTime" readonly>
            <ngx-material-timepicker #startTimePicker
                                     [min]="minTime"
                                     [max]="maxTime"
                                     [format]="24"
                                     [minutesGap]="5">
            </ngx-material-timepicker>
          </mat-form-field>
        </div>

        <!-- End Time Picker -->
        <div>
          <mat-form-field appearance="fill" class="w-full">
            <mat-label>End Time</mat-label>
            <input matInput [ngxTimepicker]="endTimePicker" formControlName="AttendanceEndTime" readonly>
            <ngx-material-timepicker #endTimePicker
                                     [min]="minTime"
                                     [max]="maxTime"
                                     [format]="24"
                                     [minutesGap]="5">
            </ngx-material-timepicker>
          </mat-form-field>
        </div>

      </div>
      <div class=" mb-6">
        <button type="submit" class="btn bg-info text-white mt-6 me-1">Submit</button>
      </div>
    </form>

    <div class="flex justify-between flex-wrap items-center mb-3 p-3 py-2 bg-light"><b class="text-1xl-5"><i class="ti ti-search"></i> Enter Search Criteria</b></div>

    <form #form="ngForm" (ngSubmit)="GetAllRosterDisplay()" class="grid 2xl:grid-cols-4 xl:grid-cols-4 lg:grid-cols-3 md:grid-cols-2 grid-cols-1 gap-3 mb-8">
      <div>
        <label class="text-gray-800 text-sm font-medium inline-block mb-1">Stream </label>
        <select class="form-select" [(ngModel)]="filterModel.StreamID" name="StreamID">
          <option [value]="0">--Select--</option>
          <option *ngFor="let item of StreamMasterDDL" [value]="item.StreamID">{{ item.StreamName}}</option>
        </select>
      </div>

      <div>
        <label class="text-gray-800 text-sm font-medium inline-block mb-1">Semester </label>
        <select class="form-select" [(ngModel)]="filterModel.SemesterID" name="SemesterID">
          <option [value]="0">--Select--</option>
          <option *ngFor="let item of SemesterMasterDDL" [value]="item.SemesterID">{{ item.SemesterName}}</option>
        </select>
      </div>

      <div>
        <label class="text-gray-800 text-sm font-medium inline-block mb-1">Subject</label>
        <select class="form-select" [(ngModel)]="filterModel.SubjectID" name="SubjectID">
          <option [value]="0">--Select--</option>
          <option *ngFor="let item of SubjectMasterDDL" [value]="item.ID">{{ item.Name}}</option>
        </select>
      </div>

      <div>
        <label class="text-gray-800 text-sm font-medium inline-block mb-1">Teachers</label>
        <select class="form-select" [(ngModel)]="filterModel.StaffID" name="Teachers">
          <option [value]="0">--Select--</option>
          <option *ngFor="let item of SubjectMasterDDL" [value]="item.ID">{{ item.Name}}</option>
        </select>
      </div>

      <!-- Buttons -->
      <div>
        <button type="submit" class="btn bg-info text-white mt-6">Search</button>
        <button type="button" class="btn bg-danger text-white mt-6" (click)="resetForm()">
          <i class="ti ti-refresh"></i> Reset
        </button>
      </div>

    </form>

    <div class="flex justify-between flex-wrap items-center mt-3 mb-3 p-3 py-2 bg-light">
      <b class="text-1xl-5"><i class="ti ti-list"></i> Search Results</b>
      <div class="flex justify-end flex-wrap items-center">
        <a href="javascript:void(0);" (click)="exportToExcel()" class="btn bg-info btn-sm text-white">
          <i class="ti ti-download"></i> Export Execl
        </a>
      </div>
    </div>
    <!-- Table -->
    <div class="mat-elevation-z8 table-responsive">
      <table mat-table [dataSource]="dataSource" matSort class="mat-elevation-z8" *ngIf="this.filterData.length > 0">

        <!-- Dynamic columns -->
        <ng-container *ngFor="let column of columnSchema" [matColumnDef]="column.key">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>
            {{ column.label }}
          </th>
          <td mat-cell *matCellDef="let element">
            <ng-container [ngSwitch]="column.key">
              <!-- Action Column -->
              <!--<ng-container *ngSwitchCase="'Action'">
    <a *ngIf="(filterModel.Action === 'provisional-certificate' || filterModel.Action === 'migration-certificate'|| filterModel.Action === 'certificate-letter')" href="javascript:void(0);"
     (click)="CertificateDownload(element.StudentID)" title="Certificate"
     class="btn bg-info btn-sm text-white">
    <i class="ti ti-download"></i> Download
  </a>
  </ng-container>-->
              <ng-container *ngSwitchCase="'AttendanceDate'">
                {{ element[column.key] | date }}
              </ng-container>
              <ng-container *ngSwitchDefault>
                {{ element[column.key] }}
              </ng-container>

            </ng-container>
</td>
        </ng-container>

        <!-- Table Rows -->
        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

      </table>
    </div>

    <div class="alert alert-warning text-center" role="alert" *ngIf="totalRecords == 0">
      No Record Found
    </div>
    <!-- Pagination Controls -->
    <mat-paginator [pageSize]="pageSize" [pageSizeOptions]="[10, 20, 50, 100, 500, 1000]"
                   [length]="totalRecords" (page)="onPaginationChange($event)">
    </mat-paginator>

  </div>
</div>

